#!/bin/bash

if [ $# -ne 1 ];then
  echo "Error: need the CLUSTER name to compile against"
  exit 1
fi
CLUSTER=$1
echo "Info: building against $CLUSTER"


if [ ! -d outTokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser ]
then
  mkdir outTokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser
fi 

javac -Xlint:deprecation -Xlint:unchecked  -cp  `/home/gs/gridre/yroot.$CLUSTER/share/hadoop/bin/hadoop  --config /home/gs/gridre/yroot.$CLUSTER/conf/hadoop  classpath` -d outTokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser TokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser.java
if [ $? -ne 0 ]
then
   echo "Error compiling"
   exit 1
fi

jar -cvf TokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser.jar -C outTokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser .
if [ $? -ne 0 ]
then
   echo "Error packaging jar"
   exit 1
fi

echo "RUNME: /home/gs/gridre/yroot.$CLUSTER/share/hadoop/bin/hadoop --config /home/gs/gridre/yroot.$CLUSTER/conf/hadoop/ jar `pwd`/TokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser.jar TokenRenewalTest_doasBlock_cleanUgi_proxyUser_CurrentUser" 

